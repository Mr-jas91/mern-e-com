import{c as V,j as e,u as de,a as he,e as c,aa as U,ab as P,B as x,T as k,f as d,G as u,z as n,ac as me,ad as ue,ae as xe,af as pe}from"./index-Bg7Lztdd.js";import{C as ge,S as je,M as fe,T as Ce,a as be,b as ye,c as A,d as o,e as ve}from"./Style-Ccpit8DN.js";import{A as G,I as F,D as we}from"./Delete-CDeJBXRt.js";import{C as De,D as T,a as E,b as q,c as M}from"./DialogTitle-FjZnM06n.js";import{T as H,F as Se,I as Ie,S as Pe}from"./TextField-B6hv7PeN.js";import{M as ke}from"./MenuItem-C3_If5kC.js";import"./Modal-BbAonJu_.js";import"./List-DQDaG03M.js";import"./listItemButtonClasses-Wh8hGUTv.js";import"./ListItemText-BEUB2tEs.js";import"./isHostComponent-CIBwoAig.js";const Ae=V(e.jsx("path",{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}),"Close"),Fe=V(e.jsx("path",{d:"M3 17.25V21h3.75L17.81 9.94l-3.75-3.75zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34a.996.996 0 0 0-1.41 0l-1.83 1.83 3.75 3.75z"}),"Edit"),C=10,Ue=()=>{const r=de(),{products:W,categories:X,loading:z,error:O}=he(s=>s.products),[$,b]=c.useState(!1),[j,y]=c.useState(!1),[J,v]=c.useState(null),[K,R]=c.useState(!1),[Q,Y]=c.useState(null),[Z,_]=c.useState(!1),[h,p]=c.useState({name:"",description:"",price:"",discountPrice:"",stock:"",categoryId:"",images:[]}),[f,B]=c.useState({name:""});c.useEffect(()=>{r(U()),r(P())},[r]);const ee=()=>{p({name:"",description:"",price:"",discountPrice:"",stock:"",categoryId:"",images:[]}),y(!1),v(null),b(!0)},se=s=>{var t;p({name:s.name,description:s.description,price:s.price,discountPrice:s.price-(s.discount||0),stock:s.stock,categoryId:((t=s.category)==null?void 0:t._id)||"",images:s.images.map(a=>({url:a}))}),y(!0),v(s._id),b(!0)},w=()=>{b(!1),y(!1),v(null)},te=()=>{B({name:""}),_(!0)},D=()=>_(!1),ae=s=>{B({name:s.target.value})},ie=async()=>{if(!f.name.trim()){n("error","Category name is required.");return}try{await r(me({name:f.name})),n("success","Category added successfully"),r(U()),D()}catch{n("error","Failed to add category")}},re=s=>{Y(s),R(!0)},S=()=>R(!1),ne=async()=>{try{await r(ue(Q)),n("success","Product deleted successfully"),r(P())}catch{n("error","Failed to delete product")}S()},L=s=>{const{name:t,value:a}=s.target;p(i=>({...i,[t]:a}))},oe=s=>{const t=Array.from(s.target.files);if(h.images.length+t.length>C){n("error",`Max ${C} images allowed.`);return}const a=t.map(i=>({file:i,url:URL.createObjectURL(i)}));p(i=>({...i,images:[...i.images,...a]}))},le=s=>{p(t=>{var i,m,g;const a=[...t.images];return(i=a[s])!=null&&i.url&&!((m=a[s])!=null&&m.file)||URL.revokeObjectURL((g=a[s])==null?void 0:g.url),a.splice(s,1),{...t,images:a}})},ce=async()=>{const{name:s,description:t,price:a,discountPrice:i,stock:m,categoryId:g,images:N}=h;if(!s.trim()||!t.trim()||!a||!i||!m||!g||N.length===0){n("error","All fields and at least one image are required.");return}const l=new FormData;l.append("name",s),l.append("description",t),l.append("price",a),l.append("discountPrice",i),l.append("stock",m),l.append("categoryId",g),N.forEach(I=>{I.file&&l.append("images",I.file)});try{j?(await r(xe({id:J,formData:l})),n("success","Product updated successfully")):(await r(pe(l)),n("success","Product added successfully")),r(P()),w()}catch{n("error",j?"Failed to update product":"Failed to add product")}};return e.jsxs(x,{sx:{display:"flex"},children:[e.jsx(ge,{}),e.jsx(je,{}),e.jsxs(fe,{children:[e.jsx(Ce,{}),e.jsx(k,{variant:"h4",textAlign:"center",mb:2,children:"Products"}),e.jsxs(x,{p:2,children:[e.jsxs(x,{display:"flex",gap:2,flexWrap:"wrap",mb:2,children:[e.jsx(d,{variant:"contained",startIcon:e.jsx(G,{}),onClick:ee,children:"Add Product"}),e.jsx(d,{variant:"contained",startIcon:e.jsx(G,{}),onClick:te,children:"Add Category"})]}),z?e.jsx(x,{textAlign:"center",py:4,children:e.jsx(De,{})}):O?e.jsxs(k,{color:"error",children:["Error: ",O]}):e.jsxs(be,{size:"small",children:[e.jsx(ye,{children:e.jsx(A,{children:["Image","Name","Description","Price","Discount Price","Stock","Category","Actions"].map(s=>e.jsx(o,{children:s},s))})}),e.jsx(ve,{children:W.length===0?e.jsx(A,{children:e.jsx(o,{colSpan:8,align:"center",children:"No Product Available"})}):W.map(s=>{var t;return e.jsxs(A,{hover:!0,sx:{height:"120px"},children:[" ",e.jsxs(o,{sx:{width:"120px"},children:[" ",e.jsx(x,{component:"img",src:s.images[0],alt:"preview",sx:{width:100,height:100,objectFit:"cover",borderRadius:1}})]}),e.jsx(o,{sx:{maxWidth:"150px",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:s.name}),e.jsx(o,{sx:{maxWidth:"250px",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:s.description}),e.jsxs(o,{sx:{width:"100px"},children:[" ",s.price]}),e.jsxs(o,{sx:{width:"100px"},children:[" ",s.discountPrice||s.price-(s.discount||0)]}),e.jsxs(o,{sx:{width:"80px"},children:[" ",s.stock]}),e.jsx(o,{sx:{maxWidth:"120px",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:(t=s.category)==null?void 0:t.name}),e.jsxs(o,{align:"right",sx:{width:"120px"},children:[" ",e.jsx(F,{onClick:()=>se(s),size:"small",children:e.jsx(Fe,{fontSize:"inherit"})}),e.jsx(F,{color:"error",onClick:()=>re(s._id),size:"small",children:e.jsx(we,{fontSize:"inherit"})})]})]},s._id)})})]})]}),e.jsxs(T,{open:$,onClose:w,maxWidth:"md",fullWidth:!0,children:[e.jsx(E,{children:j?"Edit Product":"Add New Product"}),e.jsx(q,{dividers:!0,children:e.jsxs(u,{container:!0,spacing:2,mt:.5,children:[[{label:"Name",name:"name",xs:12},{label:"Description",name:"description",xs:12,props:{multiline:!0,rows:3}},{label:"Price",name:"price",xs:4,type:"number"},{label:"Discount Price",name:"discountPrice",xs:4,type:"number"},{label:"Stock",name:"stock",xs:4,type:"number"}].map(({label:s,name:t,xs:a,type:i,props:m})=>e.jsx(u,{item:!0,xs:a,children:e.jsx(H,{fullWidth:!0,label:s,name:t,type:i||"text",value:h[t],onChange:L,...m})},t)),e.jsx(u,{item:!0,xs:12,sm:6,children:e.jsxs(Se,{fullWidth:!0,children:[e.jsx(Ie,{id:"cat-label",children:"Category"}),e.jsx(Pe,{labelId:"cat-label",label:"Category",name:"categoryId",value:h.categoryId,onChange:L,children:X.map(s=>e.jsx(ke,{value:s._id,children:s.name},s._id))})]})}),e.jsxs(u,{item:!0,xs:12,children:[e.jsxs(d,{variant:"outlined",component:"label",children:["Select Images (max ",C,")",e.jsx("input",{hidden:!0,accept:"image/*",multiple:!0,type:"file",onChange:oe})]}),e.jsxs(k,{variant:"body2",ml:2,component:"span",children:[h.images.length," / ",C," selected"]})]}),h.images.length>0&&e.jsx(u,{item:!0,xs:12,children:e.jsx(u,{container:!0,spacing:2,children:h.images.map((s,t)=>e.jsxs(u,{item:!0,xs:4,sm:3,md:2,position:"relative",children:[e.jsx(x,{component:"img",src:s.url||s,alt:"preview",sx:{width:"100%",height:100,objectFit:"cover",borderRadius:1,transition:"filter 0.3s"}}),e.jsx(F,{size:"small",onClick:()=>le(t),sx:{position:"absolute",top:4,right:4,bgcolor:"rgba(0,0,0,0.6)",color:"#fff","&:hover":{bgcolor:"rgba(0,0,0,0.8)"}},children:e.jsx(Ae,{fontSize:"inherit"})})]},t))})})]})}),e.jsxs(M,{children:[e.jsx(d,{onClick:w,children:"Cancel"}),e.jsx(d,{variant:"contained",onClick:ce,disabled:z,children:j?"Update":"Save"})]})]}),e.jsxs(T,{open:Z,onClose:D,maxWidth:"xs",fullWidth:!0,children:[e.jsx(E,{children:"Add Category"}),e.jsx(q,{dividers:!0,children:e.jsx(H,{autoFocus:!0,fullWidth:!0,label:"Category Name",value:f.name,onChange:ae})}),e.jsxs(M,{children:[e.jsx(d,{onClick:D,children:"Cancel"}),e.jsx(d,{variant:"contained",onClick:ie,disabled:!f.name.trim(),children:"Save"})]})]}),e.jsxs(T,{open:K,onClose:S,maxWidth:"xs",children:[e.jsx(E,{children:"Are you sure?"}),e.jsxs(M,{children:[e.jsx(d,{onClick:S,children:"Cancel"}),e.jsx(d,{variant:"contained",color:"error",onClick:ne,children:"Delete"})]})]})]})]})};export{Ue as default};
